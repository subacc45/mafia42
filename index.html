<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>마피아42 카드 뽑기</title>
<style>
body{background:#0f172a;color:#e6eef8;font-family:Inter,Roboto,Apple SD Gothic Neo,맑은고딕,sans-serif;margin:0;padding:30px}
.wrap{max-width:680px;margin:auto;text-align:center}
select,input,button{padding:8px 10px;border:none;border-radius:8px;font-size:15px}
select,input{background:#1e293b;color:#e6eef8}
button{background:#7c3aed;color:white;cursor:pointer}
table{width:100%;border-collapse:collapse;margin-top:20px}
th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.1);text-align:left}
.muted{color:#94a3b8;font-size:13px}
</style>
</head>
<body>
<div class="wrap">
  <h2>마피아42 카드 뽑기</h2>
  <div>
    <select id="mode">
      <option value="advanced">고급 카드팩 (10장)</option>
      <option value="4">4티어</option>
      <option value="5">5티어</option>
      <option value="6">6티어</option>
    </select>
    <input id="count" type="number" min="1" max="500" value="10">
    <button id="draw">뽑기</button>
  </div>
  <div id="result"></div>
</div>

<script>
const CATEGORIES=["마피아","마피아 팀 보조","경찰 계열","의사","시민 팀 특수","교주"];
const WEIGHTS=[3,1,1,1,5,1];
const mafia_support=["스파이","짐승인간","마담","도둑","마녀","과학자","사기꾼","청부업자"];
const police=["경찰","자경단원","요원"];
const citizen_special=["군인","정치인","영매","연인","기자","건달","사립탐정","도굴꾼","테러리스트","성직자","예언자","판사","간호사","마술사","해커","심리학자","용병","공무원","파파라치","비밀결사","최면술사","점쟁이"];

const COMMON_SKILLS=["결백","도주","독심술","밀서","배심원","위증","유언","지박령","확성기"];
const MAFIA_TEAM_SKILLS=["지령","시한부","암구호"];
const SUPPORT_ONLY=["밀정"];
const CITIZEN_TEAM_SKILLS=["유품","정보원"];
const UNIQUE={
"마피아":["무법자","수배","수습","승부수","야습","위선","은폐","저격","퇴마"],
"스파이":["미인계","부검","자객"],"짐승인간":["야만성","포효"],"마담":["데뷔","현혹"],
"도둑":["후계자","조문"],"마녀":["망각술"],"과학자":["분석","왜곡"],"사기꾼":["미인계"],
"청부업자":["직감"],"경찰":["도청","기밀","부검","영장"],"자경단원":["결사"],"요원":["휴민트"],
"의사":["검진","박애","진정"],"군인":["불굴","정신력"],"정치인":["불문율","독재"],"영매":["강령"],
"연인":["원한","헌신"],"기자":["속보","부고"],"건달":["연타","길동무"],"사립탐정":["도청","함정"],
"도굴꾼":["계승","망령"],"테러리스트":["유폭","섬광"],"성직자":["축복","구마"],"예언자":["선각자","사도"],
"판사":["불문율","관권"],"간호사":["검시","선서"],"마술사":["조수","투시"],"해커":["도청","동기화"],
"심리학자":["프로파일링"],"용병":["결사","추적"],"공무원":["색출","감사","공조"],"파파라치":["눈치"],
"비밀결사":["검시","표식"],"최면술사":["암시"],"점쟁이":["아르카나"],"교주":["설파"]
};

function weightedChoice(items,weights){
  let t=weights.reduce((a,b)=>a+b,0),r=Math.random()*t;
  for(let i=0;i<items.length;i++){r-=weights[i];if(r<0)return items[i];}
  return items[items.length-1];
}
function pickRole(cat){
  if(cat==="마피아")return "마피아";
  if(cat==="마피아 팀 보조")return mafia_support[Math.random()*mafia_support.length|0];
  if(cat==="경찰 계열")return police[Math.random()*police.length|0];
  if(cat==="의사")return "의사";
  if(cat==="시민 팀 특수")return citizen_special[Math.random()*citizen_special.length|0];
  return "교주";
}
function team(role){
  if(["마피아",...mafia_support].includes(role))return "마피아 팀";
  if([...police,"의사",...citizen_special].includes(role))return "시민 팀";
  if(role==="교주")return "교주 팀";
  return "미정";
}
function skillsFor(role,tier){
  const cnt=Math.max(0,tier-3);
  const s=new Set(COMMON_SKILLS);
  const tm=team(role);
  if(tm==="마피아 팀"||tm==="교주 팀")MAFIA_TEAM_SKILLS.forEach(x=>s.add(x));
  if(tm==="마피아 팀"&&mafia_support.includes(role))SUPPORT_ONLY.forEach(x=>s.add(x));
  if(tm==="시민 팀")CITIZEN_TEAM_SKILLS.forEach(x=>s.add(x));
  (UNIQUE[role]||[]).forEach(x=>s.add(x));
  const arr=[...s];
  const out=[];
  for(let i=0;i<cnt&&arr.length>0;i++){
    const idx=Math.random()*arr.length|0;
    out.push(arr[idx]);
    arr.splice(idx,1);
  }
  return out;
}
function pickTier(){
  const r=Math.random()*100;
  if(r<89.1)return 3;
  if(r<99)return 4;
  return 5;
}
function drawAdvanced(){
  let cards=[];
  for(let i=0;i<10;i++){
    const t=pickTier(),cat=weightedChoice(CATEGORIES,WEIGHTS),role=pickRole(cat);
    cards.push({tier:t,role,skills:skillsFor(role,t)});
  }
  if(cards.every(c=>c.tier===3)){
    const i=Math.random()*cards.length|0;
    const r=cards[i];
    cards[i]={tier:4,role:r.role,skills:skillsFor(r.role,4)};
  }
  return cards;
}
function drawFixed(tier,n){
  let arr=[];
  for(let i=0;i<n;i++){
    const cat=weightedChoice(CATEGORIES,WEIGHTS),role=pickRole(cat);
    arr.push({tier,role,skills:skillsFor(role,tier)});
  }
  return arr;
}

document.getElementById("draw").onclick=()=>{
  const m=document.getElementById("mode").value;
  const n=parseInt(document.getElementById("count").value)||10;
  const result=m==="advanced"?drawAdvanced():drawFixed(parseInt(m),n);
  let html="<table><tr><th>#</th><th>티어</th><th>직업</th><th>스킬</th></tr>";
  result.forEach((c,i)=>{
    html+=`<tr><td>${i+1}</td><td>${c.tier}</td><td>${c.role}</td><td>${c.skills.length?c.skills.join(", "):"<span class='muted'>없음</span>"}</td></tr>`;
  });
  html+="</table>";
  document.getElementById("result").innerHTML=html;
};
</script>
</body>
</html>
